<html>
    <head>
        <meta charset="UTF-8"> 
    </head>
    <body>  
       
                    <video autoplay></video>
                    <input type="range">
                    <button id="takePhotoButton" disabled>Take Photo</button>
                    <canvas></canvas>


        <script>
            document.querySelector('#takePhotoButton').addEventListener('click', onTakePhotoButtonClick);
            const input = document.querySelector('input[type="range"]');

                var imageCapture;

               navigator.getUserMedia = navigator.getUserMedia ||
                         navigator.webkitGetUserMedia ||
                         navigator.mozGetUserMedia;

                if (navigator.getUserMedia) {
                   navigator.getUserMedia({ audio: true, video: { facingMode: "environment" ,width: 1280, height: 720 } },
                      function(stream) {
                         var video = document.querySelector('video');
                         video.srcObject = stream;
                         video.onloadedmetadata = function(e) {
                           video.play();
                         };
                      },
                      function(err) {
                         console.log("The following error occurred: " + err.name);
                      }
                   );
                } else {
                   console.log("getUserMedia not supported");
                }
                function onTakePhotoButtonClick() {
                  imageCapture.takePhoto({imageWidth: input.value})
                  .then(blob => createImageBitmap(blob))
                  .then(imageBitmap => {
                    drawCanvas(imageBitmap);
                    ChromeSamples.log(`Photo size is ${imageBitmap.width}x${imageBitmap.height}`);
                  })
                  .catch(error => ChromeSamples.log(error));
                }

                document.querySelector('video').addEventListener('play', function() {
                  document.querySelector('#takePhotoButton').disabled = false;
                });

                /* Utils */

                function drawCanvas(img) {
                  const canvas = document.querySelector('canvas');
                  canvas.width = getComputedStyle(canvas).width.split('px')[0];
                  canvas.height = getComputedStyle(canvas).height.split('px')[0];
                  let ratio  = Math.min(canvas.width / img.width, canvas.height / img.height);
                  let x = (canvas.width - img.width * ratio) / 2;
                  let y = (canvas.height - img.height * ratio) / 2;
                  canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);
                  canvas.getContext('2d').drawImage(img, 0, 0, img.width, img.height,
                      x, y, img.width * ratio, img.height * ratio);
                }

        </script>
    </body>
</html>
